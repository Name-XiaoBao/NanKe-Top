import{b as J}from"./Vote.vue_vue_type_style_index_0_lang-b1726fa2.js";import{_ as K,u as M,r as d,m as X,j as Y,k as Z,h as U,n as $,a as c,o as h,e as D,b as e,d as s,q as ee,w as u,F as E,s as te,t as r,f as N,c as B,g as j}from"./index-ca32026e.js";import{c as oe,d as W}from"./api-bcd6585b.js";import{s as y,a as A}from"./function-call-a99c9d20.js";const ne={methods:{useRoute:M},setup(){const f=M().query.uid;oe(f);const l=()=>{window.location.href="/"},w=d(!0),t=()=>{const n=document.getElementById("audioPlayer"),b=document.querySelector(".rotate");w.value?(b.style.animationPlayState="paused",n.pause()):(b.style.animationPlayState="running",n.play()),w.value=!w.value},P=d(!1),k=()=>{W(f).then(n=>{n.code==200?(document.title=n.data[0][0].title,a.value=n.data[0][0],_.value=n.data[1],m.value=n.data[1],P.value=!1,te("刷新成功")):y({title:"提示",message:n.msg}).then(()=>{U.push("/")})}).catch(n=>{console.error(n)})},a=d([]),g=d(new Date().getTime()),C=d(new Date(a.value.deadline).getTime()-g.value),F=d(0),v=d(!1),p=d(null),m=d([]),x=[{name:"分享海报",icon:"poster"},{name:"复制链接",icon:"link"},{name:"微信",icon:"wechat"},{name:"QQ",icon:"qq"}],S=d(!1),T=d(null),_=d([]),I=()=>{p.value?m.value=_.value.filter(n=>n.title.includes(p.value)):m.value=_.value},L=()=>{p.value=null,m.value=_.value},Q=n=>{n.name=="复制链接"&&A({title:"提示",message:"复制失败，请手动复制链接"}),n.name=="QQ"&&A({title:"提示",message:"打开QQ失败，请手动分享到QQ"}),n.name=="微信"&&A({title:"提示",message:"打开微信失败，请手动分享到微信"}),n.name==="分享海报"&&(v.value=!1,S.value=!0,setTimeout(()=>{const b=document.createElement("canvas");J.toCanvas(b,window.location.href,O=>{if(O)console.error("生成二维码失败",O);else{const V=document.createElement("canvas"),i=V.getContext("2d"),z=540,H=720;V.width=z,V.height=H,i.fillStyle="#EFF2F5",i.fillRect(0,0,z,H);const q=new Image;q.setAttribute("crossOrigin","anonymous"),q.src=a.value.cover,q.onload=()=>{i.drawImage(q,0,0,540,580),i.drawImage(b,20,600,100,100),i.font="30px Arial",i.fillStyle="#000",i.fillText("南科Top投票",180,50),i.font="20px Arial",i.fillStyle="#000",i.fillText(a.value.title,140,620),i.font="15px Arial",i.fillStyle="#ff0000",i.fillText("参与人数："+_.value.length,140,655),i.fillText("累计票数："+a.value.votes,140,675),i.fillText("访问人数："+a.value.views,140,695);const G=V.toDataURL();T.value.src=G}}})},100)),v.value=!1};return X(()=>{Y({duration:0,forbidClick:!0,message:"加载中..."}),W(f).then(n=>{n.code==200?(document.title=n.data[0][0].title,a.value=n.data[0][0],_.value=n.data[1],m.value=n.data[1],Z()):y({title:"提示",message:n.msg}).then(()=>{U.push("/")})}).catch(n=>{y({title:"提示",message:"该投票不存在或已被删除！"}).then(()=>{U.push("/")})}),$(()=>{g.value=new Date().getTime(),C.value=new Date(a.value.deadline).getTime()-g.value})}),{onClickLeft:l,onClickRight:t,loading:P,onRefresh:k,currentTime:g,timeDiff:C,active:F,search:p,onFinish:()=>{},options:x,onSelect:Q,showShare:v,qr_code:S,qrCodeImg:T,Participants:_,filteredParticipants:m,searchClick:I,clearClick:L,voting:a,SignUp:()=>{new Date<new Date(a.value.registrationTime.replace(/-/g,"/"))?y({title:"提示",message:`还没到报名时间哦~
报名时间为：`+a.value.registrationTime+`
报名截至为：`+a.value.endRegistrationTime}):new Date>new Date(a.value.endRegistrationTime.replace(/-/g,"/"))?y({title:"提示",message:"报名已经结束啦~"}):U.push({path:"/signup",query:{uid:f}})}}}},se={class:"topic"},ae=["src"],ie=["src"],le={class:"box"},ce={class:"date"},re={class:"title"},de={class:"boxs"},ue={class:"item"},_e={class:"num text"},me=e("p",null,"参与人数",-1),he={class:"item"},ge={class:"num text"},ve=e("p",null,"累计票数",-1),pe={class:"item"},fe={class:"num text"},xe=e("p",null,"访问次数",-1),be={class:"timing"},ye=e("span",{class:"colon"},[e("b",null,"距离投票结束还有：")],-1),we={class:"block text"},ke=e("span",{class:"colon"},"天",-1),Ce={class:"block text"},Se=e("span",{class:"colon"},"时",-1),Te={class:"block text"},Re=e("span",{class:"colon"},"分",-1),Ve={class:"block text"},qe=e("span",{class:"colon"},"秒",-1),Ue=e("br",null,null,-1),De={class:"tabs"},Pe={style:{display:"flex","flex-wrap":"wrap"}},Fe={key:0,style:{width:"100%","text-align":"center"}},Ie=["src"],Le={class:"text",style:{"margin-top":"5px","margin-bottom":"6px"}},Qe={class:"text",style:{"margin-right":"5px"}},Ee={class:"tabs"},Be={style:{margin:"0px 15px"}},Ae=["src"],Oe={style:{"margin-left":"auto","margin-right":"15px"}},ze={class:"tabs"},He={style:{padding:"10px"}},Me=e("b",null,"规则详情：",-1),Ne={ref:"qrCodeImg",style:{width:"200px","margin-top":"10px"}};function je(f,l,w,t,P,k){const a=c("van-icon"),g=c("van-nav-bar"),C=c("van-count-down"),F=c("van-search"),v=c("van-empty"),p=c("van-button"),m=c("router-link"),x=c("van-tab"),S=c("van-tabs"),T=c("van-pull-refresh"),_=c("van-action-bar-button"),I=c("van-action-bar"),L=c("van-share-sheet"),Q=c("van-dialog");return h(),D(E,null,[e("div",se,[s(g,{title:"投票详情","left-arrow":"",onClickLeft:t.onClickLeft,onClickRight:t.onClickRight},ee({_:2},[t.voting.backgroundMusic?{name:"right",fn:u(()=>[s(a,{class:"rotate",name:"music-o",size:"25"})]),key:"0"}:void 0]),1032,["onClickLeft","onClickRight"]),e("audio",{id:"audioPlayer",src:t.voting.backgroundMusic,autoplay:""},null,8,ae),s(T,{modelValue:t.loading,"onUpdate:modelValue":l[2]||(l[2]=o=>t.loading=o),onRefresh:t.onRefresh},{default:u(()=>[e("img",{style:{width:"100%"},src:t.voting.cover},null,8,ie),e("div",le,[e("div",ce,[e("p",re,r(t.voting.title),1),e("div",de,[e("div",ue,[e("p",_e,r(t.Participants.length),1),me]),e("div",he,[e("p",ge,r(t.voting.votes),1),ve]),e("div",pe,[e("p",fe,r(t.voting.views),1),xe])]),e("div",be,[s(C,{ref:"countDown",format:"HH:mm:ss:SS",time:t.timeDiff,onFinish:t.onFinish},{default:u(o=>[ye,e("span",we,r(o.days),1),ke,e("span",Ce,r(o.hours),1),Se,e("span",Te,r(o.minutes),1),Re,e("span",Ve,r(o.seconds),1),qe]),_:1},8,["time","onFinish"])])]),Ue,s(F,{modelValue:t.search,"onUpdate:modelValue":l[0]||(l[0]=o=>t.search=o),placeholder:"请输入搜索关键词","input-align":"center",background:"rgba(255,255,255,0.5)",style:{"border-radius":"10px"},onSearch:t.searchClick,onClear:t.clearClick},null,8,["modelValue","onSearch","onClear"]),s(S,{swipeable:"",animated:"",active:t.active,"onUpdate:active":l[1]||(l[1]=o=>t.active=o),background:"rgba(255,255,255,0.5)",style:{margin:"10px 0 50px 0"}},{default:u(()=>[s(x,{title:"参与人员"},{default:u(()=>[e("div",De,[e("div",Pe,[t.Participants.length==0?(h(),D("div",Fe,[s(v,{image:"/null_personnel.png","image-size":"180",description:"暂无参与人员"})])):(h(!0),D(E,{key:1},N(t.filteredParticipants,o=>(h(),B(m,{style:{background:"#fff",color:"#000","border-radius":"10px","flex-basis":"48%",margin:"1% 1%","text-align":"center","padding-bottom":"10px"},to:{path:"/detail",query:{vote:k.useRoute().query.uid,uid:o.participatingUid}}},{default:u(()=>[e("img",{style:{width:"100%",height:"150px","border-radius":"10px 10px 0 0","margin-bottom":"5px"},src:o.picture},null,8,Ie),e("span",null,r(o.title),1),e("p",Le,[e("span",Qe,r(o.numberOfVotes),1),j("票")]),s(p,{round:"",type:"success",style:{background:"rgb(225,220,166)",color:"#000000","border-radius":"10px",border:"none",width:"90%",height:"30px"}},{default:u(()=>[j("为TA投票")]),_:1})]),_:2},1032,["to"]))),256))])])]),_:1}),s(x,{title:"排行榜"},{default:u(()=>[e("div",Ee,[t.Participants.length==0?(h(),B(v,{key:0,image:"/null_personnel.png","image-size":"180",description:"暂无参与人员"})):(h(!0),D(E,{key:1},N(t.Participants.sort((o,R)=>R.numberOfVotes-o.numberOfVotes),(o,R)=>(h(),B(m,{style:{color:"#000",height:"80px","border-bottom":"1px solid #e3dfdf",display:"flex","align-items":"center"},to:{path:"/detail",query:{vote:k.useRoute().query.uid,uid:o.participatingUid}}},{default:u(()=>[e("span",Be,r(R+1),1),e("img",{class:"avatars",src:o.avatar},null,8,Ae),e("span",null,r(o.nickname),1),e("span",Oe,"票数："+r(o.numberOfVotes),1)]),_:2},1032,["to"]))),256))])]),_:1}),s(x,{title:"规则详情"},{default:u(()=>[e("div",ze,[e("div",He,[Me,e("pre",null,r(t.voting.rule),1)])])]),_:1})]),_:1},8,["active"])])]),_:1},8,["modelValue","onRefresh"])]),s(I,{style:{height:"54px"}},{default:u(()=>[s(_,{class:"topic",style:{"border-radius":"20px","margin-right":"2px",color:"#000"},type:"warning",text:"我要报名",icon:"/application.png",onClick:t.SignUp},null,8,["onClick"]),s(_,{class:"topic",style:{"border-radius":"20px","margin-left":"2px",color:"#000"},type:"warning",text:"分享给好友",icon:"/share.png",onClick:l[3]||(l[3]=o=>t.showShare=!0)})]),_:1}),s(L,{show:t.showShare,"onUpdate:show":l[4]||(l[4]=o=>t.showShare=o),title:"立即分享给好友",options:t.options,onSelect:t.onSelect},null,8,["show","options","onSelect"]),s(Q,{show:t.qr_code,"onUpdate:show":l[5]||(l[5]=o=>t.qr_code=o),style:{"text-align":"center"},title:"分享海报","show-cancel-button":""},{default:u(()=>[e("img",Ne,null,512)]),_:1},8,["show"])],64)}const Xe=K(ne,[["render",je]]);export{Xe as default};
